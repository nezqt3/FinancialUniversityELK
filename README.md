# MAX Hackathon stack

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —á–∞—Å—Ç–µ–π:

- `backend/textbot` ‚Äî –Ω–∞—Ç–∏–≤–Ω—ã–π –±–æ—Ç –Ω–∞ `@maxhub/max-bot-api`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É `startapp`
- `miniapp` ‚Äî React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ MAX UI, —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å [MAX Bridge](https://dev.max.ru/docs/webapps/bridge) –∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `backend/textbot/.env` –∏ —É–∫–∞–∂–∏—Ç–µ:
   - `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –∏–∑ MAX Business
   - `BOT_USERNAME` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π –Ω–∏–∫ –±–æ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ deep-link –≤–∏–¥–∞ `https://max.ru/<bot>?startapp`)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:

```bash
cd backend/textbot
npm install
node main.js
```

–ö–æ–º–∞–Ω–¥–∞ `/start` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç inline-–∫–Ω–æ–ø–∫—É. –°—Å—ã–ª–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç `startapp=<payload>`, –≥–¥–µ payload ‚Äî base64url JSON —Å ID –∏ –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç miniapp –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è.

## –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ dev-—Ä–µ–∂–∏–º–µ:

```bash
cd miniapp
npm install
npm start
```

2. –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `npm run build` –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `miniapp/build` –Ω–∞ HTTPS-—Ö–æ—Å—Ç–∏–Ω–≥ (Vercel, GitHub Pages –∏ —Ç. –¥.). –≠—Ç—É —Å—Å—ã–ª–∫—É –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ MAX Business ‚Üí **–ß–∞—Ç-–±–æ—Ç –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** ‚Üí **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å**, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://dev.max.ru/docs/webapps/introduction#–ö–∞–∫%20–æ—Ç–∫—Ä—ã—Ç—å%20–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ%20–ø–æ%20–ø—Ä—è–º–æ–π%20—Å—Å—ã–ª–∫–µ).

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ start_param

MAX –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å payload –≤—Ä—É—á–Ω—É—é:

```bash
PAYLOAD=$(node -e "console.log(Buffer.from(JSON.stringify({firstName:'Demo',role:'abiturient'})).toString('base64').replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,''))")
open \"http://localhost:3000/?WebAppStartParam=$PAYLOAD\"
```

Miniapp –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `https://st.max.ru/js/max-web-app.js`, –≤—ã–∑—ã–≤–∞–µ—Ç `WebApp.ready()` –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å `window.WebApp.initDataUnsafe`. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω–µ MAX, –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `WebAppStartParam` –∏–∑ query string –∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

## –ö–∞–∫ —Å–≤—è–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´üöÄ –û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª –≤ —á–∞—Ç–µ –±–æ—Ç–∞.
2. MAX –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É `https://max.ru/<botName>?startapp=<payload>` –≤–Ω—É—Ç—Ä–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç miniapp –ø–æ URL, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤ MAX Business.
3. –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç `payload` –≤ `start_param` –∏ –≤ GET-–ø–∞—Ä–∞–º–µ—Ç—Ä `WebAppStartParam`.
4. React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç payload, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è/ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—ã—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ —Ç–∞–∫–∂–µ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `WebApp.ready()`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º miniapp –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç, –∫—Ç–æ —Å –Ω–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –º–æ–∂–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–∑–∞—è–≤–∫–∞, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –∑–∞—è–≤–∫–∏ –≤ –¥–µ–∫–∞–Ω–∞—Ç –∏ —Ç. –¥.).

## –ê–∫–∫–∞—É–Ω—Ç—ã –∏ SQL-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ

API (`backend/api`) —Ç–µ–ø–µ—Ä—å –ø–æ–¥–Ω–∏–º–∞–µ—Ç –ª—ë–≥–∫—É—é SQLite-–±–∞–∑—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π:

- –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `backend/api/storage/data/max-miniapp.db`, —Ç–∞–±–ª–∏—Ü–∞ `accounts` –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã;
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ `sqlite3`, –ø–æ—ç—Ç–æ–º—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ/–ª–æ–∫–∞–ª—å–Ω–æ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (macOS –∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ Linux-–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤ —É–∂–µ –≤–∫–ª—é—á–∞—é—Ç –µ—ë);
- —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- `POST /api/accounts/register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (–§–ò–û, –ø–æ—á—Ç–∞, –≤—É–∑, –∫—É—Ä—Å, –≥—Ä—É–ø–ø–∞, –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é);
- `POST /api/accounts/login` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ø–æ—á—Ç–µ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
- `GET /api/accounts/:id` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è miniapp –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏).
- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite —Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–µ scrypt-—Ö—ç—à–∞ + —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–æ–ª–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∏—Ç –µ–≥–æ –∏ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏).

Miniapp –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è). –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å –≥—Ä—É–ø–ø—É –∏–∑ –º–æ–¥—É–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –≤—Ä—É—á–Ω—É—é ‚Äî –≤—ã–±—Ä–∞–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —ç–∫—Ä–∞–Ω–æ–º ¬´–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ¬ª. –ù–∞ –≥–æ—Ç–æ–≤–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –§–ò–û, –≤—É–∑, –∫—É—Ä—Å –∏ —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –ø–ª—é—Å –∫–Ω–æ–ø–∫–∏ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª –∏ ¬´–í—ã–π—Ç–∏¬ª.
